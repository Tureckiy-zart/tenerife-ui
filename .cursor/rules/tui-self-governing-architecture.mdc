# üèõÔ∏è TUI Self-Governing Architecture Rules

**Status:** ‚úÖ ACTIVE  
**Priority:** CRITICAL  
**Date Created:** 2025-12-12  
**Layer:** META / ARCHITECTURE GUARD

---

## üìã Overview

This rule file establishes permanent self-governing rules for Cursor when working with `@tenerife.music/ui`. Cursor must internalize and enforce the token-driven design system approach (Token Union + Responsive<T>) and reject any implementation that violates these rules in future work.

**Intent:** Make Cursor self-correcting and architecture-aware, so future components and refactors automatically follow the established design system without re-explanation.

---

## üîí Core Architecture Rules

### Rule 1: NO_STRING_VISUAL_PROPS

**ALWAYS** enforce: Public component props MUST NOT use raw `string` or `number` types for any visual, layout, spacing, sizing, color, typography, motion, or elevation values.

**Explanation:** Raw strings and numbers break design consistency and prevent IntelliSense. All visual props must be tokenized.

**Enforcement:** If a visual prop is detected with string/number typing, Cursor must refactor it to a token union type or refuse to proceed.

**Examples:**

```typescript
// ‚ùå FORBIDDEN
interface ButtonProps {
  padding?: string;
  margin?: number;
  color?: string;
  radius?: string;
}

// ‚úÖ REQUIRED
interface ButtonProps {
  padding?: ResponsiveSpace;
  margin?: ResponsiveSpace;
  bg?: ResponsiveColor;
  radius?: ResponsiveRadius;
}
```

---

### Rule 2: TOKEN_UNION_ONLY

**ALWAYS** enforce: All visual props MUST use Token Union types, optionally wrapped in Responsive<T>.

**Explanation:** Token unions provide strict API, IDE autocomplete, and design consistency.

**Examples:**

```typescript
// ‚úÖ GOOD
interface ComponentProps {
  padding?: Responsive<SpaceToken>;
  gap?: Responsive<SpacingToken>;
  radius?: Responsive<RadiusToken>;
  bg?: Responsive<ColorToken>;
}

// ‚ùå BAD
interface ComponentProps {
  padding?: string;
  gap?: string | number;
  radius?: string;
  bg?: string;
}
```

**Token Union Types Location:** `src/tokens/types/index.ts`

---

### Rule 3: RESPONSIVE_CANONICAL

**ALWAYS** enforce: `Responsive<T>` is the ONLY allowed responsive typing helper. `ResponsiveValue`, `any`, or ad-hoc responsive types are forbidden.

**Explanation:** `Responsive<T>` is the canonical type defined in `src/types/responsive.ts`. All responsive props must use this type.

**Enforcement:** If `ResponsiveValue` or similar types are encountered, they must be renamed to `Responsive<T>`.

**Canonical Definition:**

```typescript
// src/types/responsive.ts
export type Responsive<T> =
  | T
  | {
      base?: T;
      sm?: T;
      md?: T;
      lg?: T;
      xl?: T;
      "2xl"?: T;
    };
```

**Examples:**

```typescript
// ‚úÖ GOOD
import type { Responsive } from "@/types/responsive";
padding?: Responsive<SpaceToken>;

// ‚ùå BAD
padding?: ResponsiveValue<SpaceToken>;
padding?: string | { base?: string; md?: string };
```

---

### Rule 4: TOKEN_DOMAINS_ONLY

**ALWAYS** enforce: All token union types MUST belong to a defined token domain.

**Token Domains:**

1. **layout** - Layout spacing, container widths, flex basis
2. **space** - Spacing tokens (padding, margin, gap)
3. **surface** - Surface variants (flat, raised, sunken, outline, subtle)
4. **radius** - Border radius tokens
5. **color** - Semantic color tokens
6. **typography** - Text size, weight, line height, letter spacing
7. **motion** - Duration, easing, transitions
8. **z-index** - Elevation and layering

**Explanation:** New visual concepts must introduce a new token domain instead of using strings.

**Enforcement:** If a visual concept doesn't fit existing domains, create a new token domain in `src/tokens/types/index.ts`.

---

### Rule 5: VISUAL_PROP_NAME_DETECTION

**ALWAYS** enforce: Any prop whose name implies visual or layout behavior MUST be treated as visual and tokenized.

**Visual Prop Patterns (MUST be tokenized):**

- `padding*` ‚Üí `ResponsiveSpace` or `ResponsiveSpacing`
- `margin*` ‚Üí `ResponsiveSpace` or `ResponsiveSpacing`
- `gap*` ‚Üí `ResponsiveSpace` or `ResponsiveSpacing`
- `width*` ‚Üí Token union or `Responsive<ContainerMaxWidthToken>`
- `height*` ‚Üí Token union (if applicable)
- `size` ‚Üí Token union (if applicable)
- `variant` ‚Üí Token union (if visual variant)
- `radius*` ‚Üí `ResponsiveRadius`
- `shadow*` ‚Üí `ResponsiveShadow`
- `elevation` ‚Üí `ResponsiveShadow` or token union
- `color*` ‚Üí `ResponsiveColor`
- `bg*` ‚Üí `ResponsiveColor`
- `background*` ‚Üí `ResponsiveColor`
- `align*` ‚Üí Token union (if applicable)
- `justify*` ‚Üí Token union (if applicable)
- `zIndex` ‚Üí Token union (if applicable)
- `opacity` ‚Üí Token union (if applicable)
- `motion*` ‚Üí `ResponsiveMotion`
- `animation*` ‚Üí `ResponsiveMotion`
- `transition*` ‚Üí `ResponsiveMotion`

**Semantic Prop Exclusions (ALLOWED as strings):**

- `aria-*` - ARIA attributes
- `data-*` - Data attributes
- `id` - Element ID
- `role` - ARIA role
- `title` - Title attribute
- `name` - Form field name
- `value` - Form field value
- `href` - Link href
- `target` - Link target
- `rel` - Link rel
- `placeholder` - Input placeholder
- `type` - Input type
- `on*` - Event handlers

**Enforcement:** Before implementing any component, scan props and classify as visual or semantic. Visual props MUST be tokenized.

---

### Rule 6: NO_EXPORT_STAR

**ALWAYS** enforce: `export *` is FORBIDDEN in all public entrypoints.

**Explanation:** Explicit exports are required to avoid type leaks and unstable public APIs.

**Enforcement:** Cursor must replace `export *` with explicit exports.

**Examples:**

```typescript
// ‚ùå FORBIDDEN
export * from "./Button";
export * from "./Modal";

// ‚úÖ REQUIRED
export { Button } from "./Button";
export type { ButtonProps } from "./Button";
export { Modal } from "./Modal";
export type { ModalProps } from "./Modal";
```

**Public Entrypoints:**

- `src/index.ts` - Main library export
- `src/components/index.ts` - Component exports
- `src/hooks/index.ts` - Hook exports
- `src/lib/index.ts` - Utility exports

---

### Rule 7: SINGLE_SOURCE_OF_TRUTH_TOKENS

**ALWAYS** enforce: Token union types must be defined in centralized token files, never inline inside component files.

**Explanation:** This ensures consistency and prevents token drift.

**Token Type Location:** `src/tokens/types/index.ts`

**Enforcement:** If token unions are found inline in component files, move them to `src/tokens/types/index.ts`.

**Examples:**

```typescript
// ‚ùå FORBIDDEN (inline in component)
interface ButtonProps {
  variant?: "primary" | "secondary" | "outline"; // Inline union
}

// ‚úÖ REQUIRED (centralized)
// src/tokens/types/index.ts
export type ButtonVariantToken = "primary" | "secondary" | "outline";

// Button.tsx
import type { ButtonVariantToken } from "@/tokens/types";
interface ButtonProps {
  variant?: ButtonVariantToken;
}
```

---

### Rule 8: DX_AS_VALIDATION

**ALWAYS** enforce: If IntelliSense (Ctrl+Space) cannot suggest valid values for a visual prop, the API is considered incorrectly designed.

**Explanation:** Developer experience is a validation mechanism. If autocomplete doesn't work, the typing is wrong.

**Enforcement:** Cursor must redesign the prop typing until autocomplete works.

**Validation Checklist:**

- [ ] IntelliSense suggests valid token values
- [ ] Hover shows token union type
- [ ] Invalid values show TypeScript errors
- [ ] Responsive objects show correct breakpoint keys

---

## ü§ñ Cursor Behavior Directives

**ALWAYS** follow these directives when working with components:

1. **Before implementing any new component or modifying existing ones:**
   - Scan the props and classify them as visual or semantic
   - If a prop is visual, use an existing token union or introduce a new token domain
   - If unsure whether a prop is visual, assume it IS visual and tokenise it

2. **When encountering legacy patterns:**
   - Never silently accept legacy patterns that violate token rules
   - Refactor to token unions immediately
   - Prefer breaking changes over weakening the design system

3. **When creating new visual concepts:**
   - Create a new token domain in `src/tokens/types/index.ts`
   - Export the token union type
   - Use `Responsive<T>` wrapper if responsive behavior is needed

4. **When reviewing code:**
   - Check all visual props use token unions
   - Verify `Responsive<T>` is used (not `ResponsiveValue` or ad-hoc types)
   - Ensure no `export *` in public entrypoints
   - Validate IntelliSense works for all visual props

---

## üìö Token Domain Reference

### Spacing Tokens

```typescript
import type { ResponsiveSpace, ResponsiveSpacing } from "@/tokens/types";

// SpaceToken - Base spacing tokens
padding?: ResponsiveSpace;
margin?: ResponsiveSpace;

// SpacingToken - Combined (base + semantic + layout)
gap?: ResponsiveSpacing;
```

### Radius Tokens

```typescript
import type { ResponsiveRadius } from "@/tokens/types";

radius?: ResponsiveRadius;
borderRadius?: ResponsiveRadius;
```

### Shadow Tokens

```typescript
import type { ResponsiveShadow } from "@/tokens/types";

shadow?: ResponsiveShadow;
elevation?: ResponsiveShadow;
```

### Color Tokens

```typescript
import type { ResponsiveColor } from "@/tokens/types";

bg?: ResponsiveColor;
color?: ResponsiveColor;
background?: ResponsiveColor;
```

### Surface Tokens

```typescript
import type { ResponsiveSurface } from "@/tokens/types";

surface?: ResponsiveSurface;
variant?: ResponsiveSurface;
```

### Typography Tokens

```typescript
import type {
  ResponsiveTextSize,
  ResponsiveTextWeight,
  ResponsiveTextLineHeight,
} from "@/tokens/types";

fontSize?: ResponsiveTextSize;
fontWeight?: ResponsiveTextWeight;
lineHeight?: ResponsiveTextLineHeight;
```

### Motion Tokens

```typescript
import type { ResponsiveMotion } from "@/tokens/types";

transition?: ResponsiveMotion;
animation?: ResponsiveMotion;
duration?: ResponsiveMotion;
```

### Layout Tokens

```typescript
import type {
  ResponsiveContainerMaxWidth,
  ResponsiveContainerPadding,
  ResponsiveFlexBasis,
} from "@/tokens/types";

maxWidth?: ResponsiveContainerMaxWidth;
containerPadding?: ResponsiveContainerPadding;
flexBasis?: ResponsiveFlexBasis;
```

---

## ‚úÖ Correct Patterns

### Component Implementation

```typescript
import type { ResponsiveSpace, ResponsiveRadius, ResponsiveColor } from "@/tokens/types";

export interface CardProps extends React.HTMLAttributes<HTMLDivElement> {
  padding?: ResponsiveSpace;
  radius?: ResponsiveRadius;
  bg?: ResponsiveColor;
  gap?: ResponsiveSpace;
}

export const Card: React.FC<CardProps> = ({ padding, radius, bg, gap, ...rest }) => {
  // Implementation using token values
};
```

### Responsive Usage

```typescript
// Single value
<Card padding="md" />

// Responsive object
<Card padding={{ base: "sm", md: "lg", xl: "xl" }} />
```

### Token Domain Creation

```typescript
// src/tokens/types/index.ts
export type NewVisualToken = "option1" | "option2" | "option3";
export type ResponsiveNewVisual = Responsive<NewVisualToken>;
```

---

## ‚ùå Forbidden Patterns

### Raw String/Number Props

```typescript
// ‚ùå FORBIDDEN
interface ComponentProps {
  padding?: string;
  margin?: number;
  color?: string;
}
```

### Ad-hoc Responsive Types

```typescript
// ‚ùå FORBIDDEN
type MyResponsive = string | { base?: string; md?: string };
padding?: MyResponsive;
```

### Inline Token Unions

```typescript
// ‚ùå FORBIDDEN
interface ComponentProps {
  variant?: "primary" | "secondary" | "outline";
}
```

### Export Star

```typescript
// ‚ùå FORBIDDEN
export * from "./components";
```

---

## üîç Enforcement Checklist

Before marking any component as complete:

- [ ] All visual props use token union types
- [ ] All responsive props use `Responsive<T>` (not `ResponsiveValue`)
- [ ] No raw `string` or `number` types for visual props
- [ ] Token unions defined in `src/tokens/types/index.ts`
- [ ] No `export *` in public entrypoints
- [ ] IntelliSense works for all visual props
- [ ] All semantic props (aria-_, data-_, id, etc.) are correctly excluded
- [ ] TypeScript compilation passes
- [ ] No type errors or warnings

---

## üö´ What NOT to Do

- ‚ùå **NEVER** use raw `string` or `number` for visual props
- ‚ùå **NEVER** use `ResponsiveValue` or ad-hoc responsive types
- ‚ùå **NEVER** define token unions inline in component files
- ‚ùå **NEVER** use `export *` in public entrypoints
- ‚ùå **NEVER** silently accept legacy patterns
- ‚ùå **NEVER** weaken the design system for convenience
- ‚ùå **NEVER** skip tokenization for "simple" props

---

## ‚úÖ What TO Do

- ‚úÖ **ALWAYS** use token union types for visual props
- ‚úÖ **ALWAYS** use `Responsive<T>` for responsive props
- ‚úÖ **ALWAYS** define token unions in `src/tokens/types/index.ts`
- ‚úÖ **ALWAYS** use explicit exports in public entrypoints
- ‚úÖ **ALWAYS** refactor legacy patterns to token unions
- ‚úÖ **ALWAYS** prefer breaking changes over weakening the design system
- ‚úÖ **ALWAYS** validate IntelliSense works for visual props
- ‚úÖ **ALWAYS** classify props as visual or semantic before implementation

---

## üìã Success Criteria

Cursor demonstrates consistent use of token unions in subsequent tasks when:

- ‚úÖ No new visual props typed as `string` or `number` are introduced
- ‚úÖ All responsive props use `Responsive<T>` (canonical type)
- ‚úÖ All token unions are defined in centralized location
- ‚úÖ No `export *` in public entrypoints
- ‚úÖ IntelliSense works for all visual props
- ‚úÖ Future refactors automatically follow the established design system without re-instruction

---

**Status:** ‚úÖ ACTIVE  
**Priority:** CRITICAL  
**Last Updated:** 2025-12-12
